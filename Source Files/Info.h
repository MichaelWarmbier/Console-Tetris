#pragma once

bool EXIT_TETRIS = false;

HDC hdc = GetDC(GetConsoleWindow());


const int MapWidth = 18;
const int MapHeight = 25;
const int GlobalSpriteSize = 12;

enum Input {NONE, LEFT, RIGHT, DOWN, UP, START, LB, RB};
enum State {BEFORE, DURING, AFTER, LIMBO};

int MapShift = 2;

double FPS = 1.0 / 60.0;
double timer = 0, dt = 0;

// Game Variables //

double DropTime = .8;
double TimeSinceDrop = 0.0;

bool MayDrop = false;

int CurrentShape = 0;
int NextShape = 0;
int RotationPosition = 1;

int rX = 0; int rY = 0; int oX = 0; int oY = 0;

std::random_device generator;

int PlayerScore = 123456;

Input PlayerInput = NONE;
State GameState = BEFORE;

const int InactiveMap[MapHeight][MapWidth] {
	00,31,24,41,24,31,46,00,00,00,00,98,00,00,00,00,00,00,
	00,00,00,00,00,00,00,00,00,00,00,98,00,00,00,00,00,00,
	00,38,22,34,37,24,46,00,00,00,00,98,00,00,00,00,00,00,
	00,03,03,03,03,03,03,03,03,03,03,03,03,03,03,03,03,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,04,33,24,43,39,46,04,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,04,
	01,00,00,00,00,00,00,00,00,00,00,05,02,02,02,02,02,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	01,00,00,00,00,00,00,00,00,00,00,04,00,00,00,00,00,00,
	00,02,02,02,02,02,02,02,02,02,02,00,00,00,00,00,00,00,
};

int ActiveMap[MapHeight][MapWidth];

///////////
// Tiles //
///////////
const int Ceiling[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	1,0,0,0,0,0,0,0,0,0,0,2,
};
const int Floor[GlobalSpriteSize][GlobalSpriteSize]{
	1,0,0,0,0,0,0,0,0,0,0,2,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
};
const int LeftWall[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,0,0,0,0,0,0,0,0,0,2,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,1,
};
const int SolidBlock[GlobalSpriteSize][GlobalSpriteSize] {
	1,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,2,
};
const int RightWall[GlobalSpriteSize][GlobalSpriteSize]{
	2,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	1,0,0,0,0,0,0,0,0,0,0,0,
};
const int Cross[GlobalSpriteSize][GlobalSpriteSize]{
	2,0,0,0,0,0,0,0,0,0,0,3,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	1,0,0,0,0,0,0,0,0,0,0,0,
};
////////////////
// Characters // 
////////////////

const int Blank[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
};
const int C[GlobalSpriteSize][GlobalSpriteSize]{
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
};
const int E[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,1,1,1,1,1,1,1,0,0,0,
	0,0,1,1,1,1,1,1,1,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,1,1,1,1,1,0,0,0,
	0,0,1,1,1,1,1,1,1,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,1,1,1,1,1,0,0,0,
	0,0,1,1,1,1,1,1,1,0,0,0,
};
const int L[GlobalSpriteSize][GlobalSpriteSize]{
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,1,1,1,1,1,1,1,0,0,
	0,1,1,1,1,1,1,1,1,1,0,0,
};
const int N[GlobalSpriteSize][GlobalSpriteSize]{
	1,1,0,0,0,0,0,0,0,0,1,1,
	1,1,1,0,0,0,0,0,0,0,1,1,
	1,1,1,1,0,0,0,0,0,0,1,1,
	1,1,1,1,1,0,0,0,0,0,1,1,
	1,1,0,1,1,1,0,0,0,0,1,1,
	1,1,0,0,1,1,1,0,0,0,1,1,
	1,1,0,0,0,1,1,1,0,0,1,1,
	1,1,0,0,0,0,1,1,1,0,1,1,
	1,1,0,0,0,0,0,1,1,1,1,1,
	1,1,0,0,0,0,0,0,1,1,1,1,
	1,1,0,0,0,0,0,0,0,1,1,1,
	1,1,0,0,0,0,0,0,0,0,1,1,
};
const int O[GlobalSpriteSize][GlobalSpriteSize]{
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
};
const int R[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,1,1,1,1,1,1,1,1,0,0,
	0,0,1,1,1,1,1,1,1,1,0,0,
	0,0,1,1,0,0,0,0,1,1,0,0,
	0,0,1,1,0,0,0,0,1,1,0,0,
	0,0,1,1,1,1,1,1,1,1,0,0,
	0,0,1,1,1,1,1,1,1,1,0,0,
	0,0,1,1,1,1,0,0,0,0,0,0,
	0,0,1,1,1,1,1,0,0,0,0,0,
	0,0,1,1,0,1,1,1,0,0,0,0,
	0,0,1,1,0,0,1,1,1,0,0,0,
	0,0,1,1,0,0,0,1,1,1,0,0,
	0,0,1,1,0,0,0,0,1,1,0,0,
};
const int S[GlobalSpriteSize][GlobalSpriteSize]{
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,0,0,0,0,0,0,0,0,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,0,0,0,0,0,0,0,0,1,1,0,
	0,0,0,0,0,0,0,0,0,1,1,0,
	0,0,0,0,0,0,0,0,0,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
	0,1,1,1,1,1,1,1,1,1,1,0,
};
const int T[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,1,1,1,1,1,1,1,1,1,1,
	0,0,1,1,1,1,1,1,1,1,1,1,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
	0,0,0,0,0,0,1,1,0,0,0,0,
};
const int V[GlobalSpriteSize][GlobalSpriteSize]{
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,0,0,0,0,0,0,1,1,0,
	0,1,1,1,0,0,0,0,1,1,1,0,
	0,0,1,1,1,0,0,1,1,1,0,0,
	0,0,0,1,1,1,1,1,1,0,0,0,
	0,0,0,0,1,1,1,1,0,0,0,0,
	0,0,0,0,0,1,1,0,0,0,0,0,
};
const int X[GlobalSpriteSize][GlobalSpriteSize]{
	1,1,0,0,0,0,0,0,0,0,1,1,
	1,1,1,0,0,0,0,0,0,1,1,1,
	0,1,1,1,0,0,0,0,1,1,1,0,
	0,0,1,1,1,0,0,1,1,1,0,0,
	0,0,0,1,1,1,1,1,1,0,0,0,
	0,0,0,0,1,1,1,1,0,0,0,0,
	0,0,0,0,1,1,1,1,0,0,0,0,
	0,0,0,1,1,1,1,1,1,0,0,0,
	0,0,1,1,1,0,0,1,1,1,0,0,
	0,1,1,1,0,0,0,0,1,1,1,0,
	1,1,1,0,0,0,0,0,0,1,1,1,
	1,1,0,0,0,0,0,0,0,0,1,1,
};
const int COLON[GlobalSpriteSize][GlobalSpriteSize]{
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,1,1,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,
};
